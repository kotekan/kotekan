# -*-yaml-*-

# CHIME transpose kernel

################################################################################

# Transpose kernel setup
scatter_indices: [
      0,  128,  256,  384,  512,  640,  768,  896, 1024, 1152, 1280, 1408, 1536, 1664, 1792, 1920,
      1,  129,  257,  385,  513,  641,  769,  897, 1025, 1153, 1281, 1409, 1537, 1665, 1793, 1921,
      2,  130,  258,  386,  514,  642,  770,  898, 1026, 1154, 1282, 1410, 1538, 1666, 1794, 1922,
      3,  131,  259,  387,  515,  643,  771,  899, 1027, 1155, 1283, 1411, 1539, 1667, 1795, 1923,
      4,  132,  260,  388,  516,  644,  772,  900, 1028, 1156, 1284, 1412, 1540, 1668, 1796, 1924,
      5,  133,  261,  389,  517,  645,  773,  901, 1029, 1157, 1285, 1413, 1541, 1669, 1797, 1925,
      6,  134,  262,  390,  518,  646,  774,  902, 1030, 1158, 1286, 1414, 1542, 1670, 1798, 1926,
      7,  135,  263,  391,  519,  647,  775,  903, 1031, 1159, 1287, 1415, 1543, 1671, 1799, 1927,
      8,  136,  264,  392,  520,  648,  776,  904, 1032, 1160, 1288, 1416, 1544, 1672, 1800, 1928,
      9,  137,  265,  393,  521,  649,  777,  905, 1033, 1161, 1289, 1417, 1545, 1673, 1801, 1929,
     10,  138,  266,  394,  522,  650,  778,  906, 1034, 1162, 1290, 1418, 1546, 1674, 1802, 1930,
     11,  139,  267,  395,  523,  651,  779,  907, 1035, 1163, 1291, 1419, 1547, 1675, 1803, 1931,
     12,  140,  268,  396,  524,  652,  780,  908, 1036, 1164, 1292, 1420, 1548, 1676, 1804, 1932,
     13,  141,  269,  397,  525,  653,  781,  909, 1037, 1165, 1293, 1421, 1549, 1677, 1805, 1933,
     14,  142,  270,  398,  526,  654,  782,  910, 1038, 1166, 1294, 1422, 1550, 1678, 1806, 1934,
     15,  143,  271,  399,  527,  655,  783,  911, 1039, 1167, 1295, 1423, 1551, 1679, 1807, 1935,
     16,  144,  272,  400,  528,  656,  784,  912, 1040, 1168, 1296, 1424, 1552, 1680, 1808, 1936,
     17,  145,  273,  401,  529,  657,  785,  913, 1041, 1169, 1297, 1425, 1553, 1681, 1809, 1937,
     18,  146,  274,  402,  530,  658,  786,  914, 1042, 1170, 1298, 1426, 1554, 1682, 1810, 1938,
     19,  147,  275,  403,  531,  659,  787,  915, 1043, 1171, 1299, 1427, 1555, 1683, 1811, 1939,
     20,  148,  276,  404,  532,  660,  788,  916, 1044, 1172, 1300, 1428, 1556, 1684, 1812, 1940,
     21,  149,  277,  405,  533,  661,  789,  917, 1045, 1173, 1301, 1429, 1557, 1685, 1813, 1941,
     22,  150,  278,  406,  534,  662,  790,  918, 1046, 1174, 1302, 1430, 1558, 1686, 1814, 1942,
     23,  151,  279,  407,  535,  663,  791,  919, 1047, 1175, 1303, 1431, 1559, 1687, 1815, 1943,
     24,  152,  280,  408,  536,  664,  792,  920, 1048, 1176, 1304, 1432, 1560, 1688, 1816, 1944,
     25,  153,  281,  409,  537,  665,  793,  921, 1049, 1177, 1305, 1433, 1561, 1689, 1817, 1945,
     26,  154,  282,  410,  538,  666,  794,  922, 1050, 1178, 1306, 1434, 1562, 1690, 1818, 1946,
     27,  155,  283,  411,  539,  667,  795,  923, 1051, 1179, 1307, 1435, 1563, 1691, 1819, 1947,
     28,  156,  284,  412,  540,  668,  796,  924, 1052, 1180, 1308, 1436, 1564, 1692, 1820, 1948,
     29,  157,  285,  413,  541,  669,  797,  925, 1053, 1181, 1309, 1437, 1565, 1693, 1821, 1949,
     30,  158,  286,  414,  542,  670,  798,  926, 1054, 1182, 1310, 1438, 1566, 1694, 1822, 1950,
     31,  159,  287,  415,  543,  671,  799,  927, 1055, 1183, 1311, 1439, 1567, 1695, 1823, 1951,
     32,  160,  288,  416,  544,  672,  800,  928, 1056, 1184, 1312, 1440, 1568, 1696, 1824, 1952,
     33,  161,  289,  417,  545,  673,  801,  929, 1057, 1185, 1313, 1441, 1569, 1697, 1825, 1953,
     34,  162,  290,  418,  546,  674,  802,  930, 1058, 1186, 1314, 1442, 1570, 1698, 1826, 1954,
     35,  163,  291,  419,  547,  675,  803,  931, 1059, 1187, 1315, 1443, 1571, 1699, 1827, 1955,
     36,  164,  292,  420,  548,  676,  804,  932, 1060, 1188, 1316, 1444, 1572, 1700, 1828, 1956,
     37,  165,  293,  421,  549,  677,  805,  933, 1061, 1189, 1317, 1445, 1573, 1701, 1829, 1957,
     38,  166,  294,  422,  550,  678,  806,  934, 1062, 1190, 1318, 1446, 1574, 1702, 1830, 1958,
     39,  167,  295,  423,  551,  679,  807,  935, 1063, 1191, 1319, 1447, 1575, 1703, 1831, 1959,
     40,  168,  296,  424,  552,  680,  808,  936, 1064, 1192, 1320, 1448, 1576, 1704, 1832, 1960,
     41,  169,  297,  425,  553,  681,  809,  937, 1065, 1193, 1321, 1449, 1577, 1705, 1833, 1961,
     42,  170,  298,  426,  554,  682,  810,  938, 1066, 1194, 1322, 1450, 1578, 1706, 1834, 1962,
     43,  171,  299,  427,  555,  683,  811,  939, 1067, 1195, 1323, 1451, 1579, 1707, 1835, 1963,
     44,  172,  300,  428,  556,  684,  812,  940, 1068, 1196, 1324, 1452, 1580, 1708, 1836, 1964,
     45,  173,  301,  429,  557,  685,  813,  941, 1069, 1197, 1325, 1453, 1581, 1709, 1837, 1965,
     46,  174,  302,  430,  558,  686,  814,  942, 1070, 1198, 1326, 1454, 1582, 1710, 1838, 1966,
     47,  175,  303,  431,  559,  687,  815,  943, 1071, 1199, 1327, 1455, 1583, 1711, 1839, 1967,
     48,  176,  304,  432,  560,  688,  816,  944, 1072, 1200, 1328, 1456, 1584, 1712, 1840, 1968,
     49,  177,  305,  433,  561,  689,  817,  945, 1073, 1201, 1329, 1457, 1585, 1713, 1841, 1969,
     50,  178,  306,  434,  562,  690,  818,  946, 1074, 1202, 1330, 1458, 1586, 1714, 1842, 1970,
     51,  179,  307,  435,  563,  691,  819,  947, 1075, 1203, 1331, 1459, 1587, 1715, 1843, 1971,
     52,  180,  308,  436,  564,  692,  820,  948, 1076, 1204, 1332, 1460, 1588, 1716, 1844, 1972,
     53,  181,  309,  437,  565,  693,  821,  949, 1077, 1205, 1333, 1461, 1589, 1717, 1845, 1973,
     54,  182,  310,  438,  566,  694,  822,  950, 1078, 1206, 1334, 1462, 1590, 1718, 1846, 1974,
     55,  183,  311,  439,  567,  695,  823,  951, 1079, 1207, 1335, 1463, 1591, 1719, 1847, 1975,
     56,  184,  312,  440,  568,  696,  824,  952, 1080, 1208, 1336, 1464, 1592, 1720, 1848, 1976,
     57,  185,  313,  441,  569,  697,  825,  953, 1081, 1209, 1337, 1465, 1593, 1721, 1849, 1977,
     58,  186,  314,  442,  570,  698,  826,  954, 1082, 1210, 1338, 1466, 1594, 1722, 1850, 1978,
     59,  187,  315,  443,  571,  699,  827,  955, 1083, 1211, 1339, 1467, 1595, 1723, 1851, 1979,
     60,  188,  316,  444,  572,  700,  828,  956, 1084, 1212, 1340, 1468, 1596, 1724, 1852, 1980,
     61,  189,  317,  445,  573,  701,  829,  957, 1085, 1213, 1341, 1469, 1597, 1725, 1853, 1981,
     62,  190,  318,  446,  574,  702,  830,  958, 1086, 1214, 1342, 1470, 1598, 1726, 1854, 1982,
     63,  191,  319,  447,  575,  703,  831,  959, 1087, 1215, 1343, 1471, 1599, 1727, 1855, 1983,
     64,  192,  320,  448,  576,  704,  832,  960, 1088, 1216, 1344, 1472, 1600, 1728, 1856, 1984,
     65,  193,  321,  449,  577,  705,  833,  961, 1089, 1217, 1345, 1473, 1601, 1729, 1857, 1985,
     66,  194,  322,  450,  578,  706,  834,  962, 1090, 1218, 1346, 1474, 1602, 1730, 1858, 1986,
     67,  195,  323,  451,  579,  707,  835,  963, 1091, 1219, 1347, 1475, 1603, 1731, 1859, 1987,
     68,  196,  324,  452,  580,  708,  836,  964, 1092, 1220, 1348, 1476, 1604, 1732, 1860, 1988,
     69,  197,  325,  453,  581,  709,  837,  965, 1093, 1221, 1349, 1477, 1605, 1733, 1861, 1989,
     70,  198,  326,  454,  582,  710,  838,  966, 1094, 1222, 1350, 1478, 1606, 1734, 1862, 1990,
     71,  199,  327,  455,  583,  711,  839,  967, 1095, 1223, 1351, 1479, 1607, 1735, 1863, 1991,
     72,  200,  328,  456,  584,  712,  840,  968, 1096, 1224, 1352, 1480, 1608, 1736, 1864, 1992,
     73,  201,  329,  457,  585,  713,  841,  969, 1097, 1225, 1353, 1481, 1609, 1737, 1865, 1993,
     74,  202,  330,  458,  586,  714,  842,  970, 1098, 1226, 1354, 1482, 1610, 1738, 1866, 1994,
     75,  203,  331,  459,  587,  715,  843,  971, 1099, 1227, 1355, 1483, 1611, 1739, 1867, 1995,
     76,  204,  332,  460,  588,  716,  844,  972, 1100, 1228, 1356, 1484, 1612, 1740, 1868, 1996,
     77,  205,  333,  461,  589,  717,  845,  973, 1101, 1229, 1357, 1485, 1613, 1741, 1869, 1997,
     78,  206,  334,  462,  590,  718,  846,  974, 1102, 1230, 1358, 1486, 1614, 1742, 1870, 1998,
     79,  207,  335,  463,  591,  719,  847,  975, 1103, 1231, 1359, 1487, 1615, 1743, 1871, 1999,
     80,  208,  336,  464,  592,  720,  848,  976, 1104, 1232, 1360, 1488, 1616, 1744, 1872, 2000,
     81,  209,  337,  465,  593,  721,  849,  977, 1105, 1233, 1361, 1489, 1617, 1745, 1873, 2001,
     82,  210,  338,  466,  594,  722,  850,  978, 1106, 1234, 1362, 1490, 1618, 1746, 1874, 2002,
     83,  211,  339,  467,  595,  723,  851,  979, 1107, 1235, 1363, 1491, 1619, 1747, 1875, 2003,
     84,  212,  340,  468,  596,  724,  852,  980, 1108, 1236, 1364, 1492, 1620, 1748, 1876, 2004,
     85,  213,  341,  469,  597,  725,  853,  981, 1109, 1237, 1365, 1493, 1621, 1749, 1877, 2005,
     86,  214,  342,  470,  598,  726,  854,  982, 1110, 1238, 1366, 1494, 1622, 1750, 1878, 2006,
     87,  215,  343,  471,  599,  727,  855,  983, 1111, 1239, 1367, 1495, 1623, 1751, 1879, 2007,
     88,  216,  344,  472,  600,  728,  856,  984, 1112, 1240, 1368, 1496, 1624, 1752, 1880, 2008,
     89,  217,  345,  473,  601,  729,  857,  985, 1113, 1241, 1369, 1497, 1625, 1753, 1881, 2009,
     90,  218,  346,  474,  602,  730,  858,  986, 1114, 1242, 1370, 1498, 1626, 1754, 1882, 2010,
     91,  219,  347,  475,  603,  731,  859,  987, 1115, 1243, 1371, 1499, 1627, 1755, 1883, 2011,
     92,  220,  348,  476,  604,  732,  860,  988, 1116, 1244, 1372, 1500, 1628, 1756, 1884, 2012,
     93,  221,  349,  477,  605,  733,  861,  989, 1117, 1245, 1373, 1501, 1629, 1757, 1885, 2013,
     94,  222,  350,  478,  606,  734,  862,  990, 1118, 1246, 1374, 1502, 1630, 1758, 1886, 2014,
     95,  223,  351,  479,  607,  735,  863,  991, 1119, 1247, 1375, 1503, 1631, 1759, 1887, 2015,
     96,  224,  352,  480,  608,  736,  864,  992, 1120, 1248, 1376, 1504, 1632, 1760, 1888, 2016,
     97,  225,  353,  481,  609,  737,  865,  993, 1121, 1249, 1377, 1505, 1633, 1761, 1889, 2017,
     98,  226,  354,  482,  610,  738,  866,  994, 1122, 1250, 1378, 1506, 1634, 1762, 1890, 2018,
     99,  227,  355,  483,  611,  739,  867,  995, 1123, 1251, 1379, 1507, 1635, 1763, 1891, 2019,
    100,  228,  356,  484,  612,  740,  868,  996, 1124, 1252, 1380, 1508, 1636, 1764, 1892, 2020,
    101,  229,  357,  485,  613,  741,  869,  997, 1125, 1253, 1381, 1509, 1637, 1765, 1893, 2021,
    102,  230,  358,  486,  614,  742,  870,  998, 1126, 1254, 1382, 1510, 1638, 1766, 1894, 2022,
    103,  231,  359,  487,  615,  743,  871,  999, 1127, 1255, 1383, 1511, 1639, 1767, 1895, 2023,
    104,  232,  360,  488,  616,  744,  872, 1000, 1128, 1256, 1384, 1512, 1640, 1768, 1896, 2024,
    105,  233,  361,  489,  617,  745,  873, 1001, 1129, 1257, 1385, 1513, 1641, 1769, 1897, 2025,
    106,  234,  362,  490,  618,  746,  874, 1002, 1130, 1258, 1386, 1514, 1642, 1770, 1898, 2026,
    107,  235,  363,  491,  619,  747,  875, 1003, 1131, 1259, 1387, 1515, 1643, 1771, 1899, 2027,
    108,  236,  364,  492,  620,  748,  876, 1004, 1132, 1260, 1388, 1516, 1644, 1772, 1900, 2028,
    109,  237,  365,  493,  621,  749,  877, 1005, 1133, 1261, 1389, 1517, 1645, 1773, 1901, 2029,
    110,  238,  366,  494,  622,  750,  878, 1006, 1134, 1262, 1390, 1518, 1646, 1774, 1902, 2030,
    111,  239,  367,  495,  623,  751,  879, 1007, 1135, 1263, 1391, 1519, 1647, 1775, 1903, 2031,
    112,  240,  368,  496,  624,  752,  880, 1008, 1136, 1264, 1392, 1520, 1648, 1776, 1904, 2032,
    113,  241,  369,  497,  625,  753,  881, 1009, 1137, 1265, 1393, 1521, 1649, 1777, 1905, 2033,
    114,  242,  370,  498,  626,  754,  882, 1010, 1138, 1266, 1394, 1522, 1650, 1778, 1906, 2034,
    115,  243,  371,  499,  627,  755,  883, 1011, 1139, 1267, 1395, 1523, 1651, 1779, 1907, 2035,
    116,  244,  372,  500,  628,  756,  884, 1012, 1140, 1268, 1396, 1524, 1652, 1780, 1908, 2036,
    117,  245,  373,  501,  629,  757,  885, 1013, 1141, 1269, 1397, 1525, 1653, 1781, 1909, 2037,
    118,  246,  374,  502,  630,  758,  886, 1014, 1142, 1270, 1398, 1526, 1654, 1782, 1910, 2038,
    119,  247,  375,  503,  631,  759,  887, 1015, 1143, 1271, 1399, 1527, 1655, 1783, 1911, 2039,
    120,  248,  376,  504,  632,  760,  888, 1016, 1144, 1272, 1400, 1528, 1656, 1784, 1912, 2040,
    121,  249,  377,  505,  633,  761,  889, 1017, 1145, 1273, 1401, 1529, 1657, 1785, 1913, 2041,
    122,  250,  378,  506,  634,  762,  890, 1018, 1146, 1274, 1402, 1530, 1658, 1786, 1914, 2042,
    123,  251,  379,  507,  635,  763,  891, 1019, 1147, 1275, 1403, 1531, 1659, 1787, 1915, 2043,
    124,  252,  380,  508,  636,  764,  892, 1020, 1148, 1276, 1404, 1532, 1660, 1788, 1916, 2044,
    125,  253,  381,  509,  637,  765,  893, 1021, 1149, 1277, 1405, 1533, 1661, 1789, 1917, 2045,
    126,  254,  382,  510,  638,  766,  894, 1022, 1150, 1278, 1406, 1534, 1662, 1790, 1918, 2046,
    127,  255,  383,  511,  639,  767,  895, 1023, 1151, 1279, 1407, 1535, 1663, 1791, 1919, 2047,
]

################################################################################

# Buffers

host_scatter_indices_buffer:
    kotekan_buffer: standard
    num_frames: 1
    frame_size: sizeof_int32 * num_dishes * num_polarizations
    metadata_pool: main_pool

host_xposed_voltage_buffer:
    kotekan_buffer: standard
    num_frames: buffer_depth
    frame_size: num_dishes * num_polarizations * num_frequencies * num_times
    metadata_pool: main_pool
host_xposed_voltage_ringbuffer:
    kotekan_buffer: ring
    ring_buffer_size: buffer_depth * num_dishes * num_polarizations * num_frequencies * num_times
    metadata_pool: main_pool

################################################################################

# Stages

run_xpose2048:
    gpu_0:
        kotekan_stage: cudaProcess
        gpu_id: 0
        in_buffers:
            host_voltage_ringbuffer_in: host_voltage_ringbuffer
            host_scatter_indices_buffer_in: host_scatter_indices_buffer
        out_buffers:
            host_xposed_voltage_ringbuffer_out: host_xposed_voltage_ringbuffer
        commands:
        - name: cudaInputData
          do_once: true
          in_buf: host_scatter_indices_buffer_in
          gpu_mem: scatter_indices_buffer
        - name: cudaSyncInput
        - name: cudaTranspose2048_chime
          in_signal: host_voltage_ringbuffer_in
          out_signal: host_xposed_voltage_ringbuffer_out
          gpu_mem_input_voltage: voltage_buffer
          gpu_mem_scatter_indices: scatter_indices_buffer
          gpu_mem_output_voltage: xposed_voltage_buffer
