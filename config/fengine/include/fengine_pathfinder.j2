# -*-yaml-*-

# CHORD pathfinder F-Engine setup

################################################################################

# Dishes

num_dish_locations_ew: 12        # east-west
num_dish_locations_ns: 8         # north-south
num_dish_locations: num_dish_locations_ns * num_dish_locations_ew
dish_separation_ew: 6.3          # [m] east-west
dish_separation_ns: 8.5          # [m] north-south
num_dishes: 64

# The actual dishes live on an 11x6 grid.
dish_indices: [
    -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
    -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
    -1,-1,-1, 0, 1, 2, 3, 4, 5, 6, 7, 8,
    -1, 9,10,11,12,13,14,15,16,17,18,19,
    -1,20,21,22,23,24,25,26,27,28,29,30,
    -1,31,32,33,34,35,36,37,38,39,40,41,
    -1,42,43,44,45,46,47,48,49,50,51,52,
    -1,53,54,55,56,57,58,59,60,61,62,63,
]

# Pathfinder:
#             quantity   frequency    east-west   east-west   north-south   north-south
# 
#   angular resolution     300 MHz    14.4 mrad       0.83°     19.6 mrad         1.12°
#   angular resolution    1500 MHz     2.9 mrad       0.17°      3.9 mrad         0.22°
#        field of view     300 MHz   158.6 mrad       9.09°    117.6 mrad         6.74°
#        field of view    1500 MHz    31.7 mrad       1.82°     23.5 mrad         1.35°

host_dish_positions_buffer:
    kotekan_buffer: standard
    num_frames: 1
    frame_size: sizeof_float32 * 2 * num_dishes
    metadata_pool: main_pool

################################################################################

# ADC

adc_frequency: 3.2e+9           # [Hz]

################################################################################

# PFB

num_taps: 4
num_samples_per_frame: 16384

num_frequencies: 384       # 8192 frequencies / 16 gpus * 75% coverage
# The frequency channels we keep.
#     A channel's frequency is   freq = channel * adc_frequency / num_samples_per_frame
#     Note that   channel = freq = 0   is the DC channel.
#     Channel 1536 has 300 MHz for CHORD, channel 7680 has 1500 MHz.
#     There are 5.12 channels per MHz, with a channel width of 195312.5 Hz.
# (These particular channels were chosen with a fixed step size between these channel boundaries.)
frequency_channels: [
    1536, 1552, 1568, 1584, 1600, 1616, 1632, 1648, 1664, 1680, 1696, 1712, 1728, 1744, 1760, 1776,
    1792, 1808, 1824, 1840, 1856, 1872, 1888, 1904, 1920, 1936, 1952, 1968, 1984, 2000, 2016, 2032,
    2048, 2064, 2080, 2096, 2112, 2128, 2144, 2160, 2176, 2192, 2208, 2224, 2240, 2256, 2272, 2288,
    2304, 2320, 2336, 2352, 2368, 2384, 2400, 2416, 2432, 2448, 2464, 2480, 2496, 2512, 2528, 2544,
    2560, 2576, 2592, 2608, 2624, 2640, 2656, 2672, 2688, 2704, 2720, 2736, 2752, 2768, 2784, 2800,
    2816, 2832, 2848, 2864, 2880, 2896, 2912, 2928, 2944, 2960, 2976, 2992, 3008, 3024, 3040, 3056,
    3072, 3088, 3104, 3120, 3136, 3152, 3168, 3184, 3200, 3216, 3232, 3248, 3264, 3280, 3296, 3312,
    3328, 3344, 3360, 3376, 3392, 3408, 3424, 3440, 3456, 3472, 3488, 3504, 3520, 3536, 3552, 3568,
    3584, 3600, 3616, 3632, 3648, 3664, 3680, 3696, 3712, 3728, 3744, 3760, 3776, 3792, 3808, 3824,
    3840, 3856, 3872, 3888, 3904, 3920, 3936, 3952, 3968, 3984, 4000, 4016, 4032, 4048, 4064, 4080,
    4096, 4112, 4128, 4144, 4160, 4176, 4192, 4208, 4224, 4240, 4256, 4272, 4288, 4304, 4320, 4336,
    4352, 4368, 4384, 4400, 4416, 4432, 4448, 4464, 4480, 4496, 4512, 4528, 4544, 4560, 4576, 4592,
    4608, 4624, 4640, 4656, 4672, 4688, 4704, 4720, 4736, 4752, 4768, 4784, 4800, 4816, 4832, 4848,
    4864, 4880, 4896, 4912, 4928, 4944, 4960, 4976, 4992, 5008, 5024, 5040, 5056, 5072, 5088, 5104,
    5120, 5136, 5152, 5168, 5184, 5200, 5216, 5232, 5248, 5264, 5280, 5296, 5312, 5328, 5344, 5360,
    5376, 5392, 5408, 5424, 5440, 5456, 5472, 5488, 5504, 5520, 5536, 5552, 5568, 5584, 5600, 5616,
    5632, 5648, 5664, 5680, 5696, 5712, 5728, 5744, 5760, 5776, 5792, 5808, 5824, 5840, 5856, 5872,
    5888, 5904, 5920, 5936, 5952, 5968, 5984, 6000, 6016, 6032, 6048, 6064, 6080, 6096, 6112, 6128,
    6144, 6160, 6176, 6192, 6208, 6224, 6240, 6256, 6272, 6288, 6304, 6320, 6336, 6352, 6368, 6384,
    6400, 6416, 6432, 6448, 6464, 6480, 6496, 6512, 6528, 6544, 6560, 6576, 6592, 6608, 6624, 6640,
    6656, 6672, 6688, 6704, 6720, 6736, 6752, 6768, 6784, 6800, 6816, 6832, 6848, 6864, 6880, 6896,
    6912, 6928, 6944, 6960, 6976, 6992, 7008, 7024, 7040, 7056, 7072, 7088, 7104, 7120, 7136, 7152,
    7168, 7184, 7200, 7216, 7232, 7248, 7264, 7280, 7296, 7312, 7328, 7344, 7360, 7376, 7392, 7408,
    7424, 7440, 7456, 7472, 7488, 7504, 7520, 7536, 7552, 7568, 7584, 7600, 7616, 7632, 7648, 7664,
]

################################################################################

# Input frames

num_times: 8192

################################################################################

# Buffers

host_voltage_buffer:
    kotekan_buffer: standard
    num_frames: buffer_depth
    frame_size: num_dishes * num_polarizations * num_frequencies * num_times
    metadata_pool: main_pool
host_voltage_ringbuffer:
    kotekan_buffer: ring
    ring_buffer_size: buffer_depth * num_dishes * num_polarizations * num_frequencies * num_times
    metadata_pool: main_pool

host_expected_bb_beams_buffer:
    kotekan_buffer: standard
    num_frames: buffer_depth
    frame_size: num_times * num_polarizations * num_frequencies * bb_num_beams
    metadata_pool: main_pool

host_expected_frb1_beams_buffer:
    kotekan_buffer: standard
    num_frames: buffer_depth
    frame_size: sizeof_float16 * frb_num_beams_P * frb_num_beams_Q * upchan_all_max_num_output_channels * frb_num_output_times
    metadata_pool: main_pool
