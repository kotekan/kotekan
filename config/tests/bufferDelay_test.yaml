##########################################
#
# Test integrateHFBData stage
#
# Runs the integrateHFBData stage. Uses testDataGenFloat to generate input frames and the correct output frame.
# The correct output frame should have entries which are equal to: num_frames_to_integrate x test_value
#
##########################################
---
type: config
# Logging level can be one of:
# OFF, ERROR, WARN, INFO, DEBUG, DEBUG2 (case insensitive)
# Note DEBUG and DEBUG2 require a build with (-DCMAKE_BUILD_TYPE=Debug)
log_level: info
buffer_depth: 56
baseband_buffer_depth: 120  # 48Gb, 15s buffer.
cpu_affinity: [2,3,8,9]

# Constants
sizeof_float: 4
num_frb_total_beams: 1024
factor_upchan: 128
num_frames_to_integrate: 8
good_samples_threshold: 0.50
test_value: 2
samples_per_data_set: 1024
num_frames_to_hold: 48
copy_frame: false

# Pool
main_pool:
  kotekan_metadata_pool: chimeMetadata
  num_metadata_objects: 30 * buffer_depth + 5 * baseband_buffer_depth

# Buffers
input_buffer:
  num_frames: buffer_depth
  frame_size: samples_per_data_set * sizeof_float
  metadata_pool: main_pool
  kotekan_buffer: standard

output_buffer:
  num_frames: buffer_depth
  frame_size: samples_per_data_set * sizeof_float
  metadata_pool: main_pool
  kotekan_buffer: standard

# Generate input data for integrateHFBData stage
gen_input_data:
  type: const
  gen_all_const_data: true
  value: test_value
  kotekan_stage: testDataGenFloat
  network_out_buf: input_buffer 

# Generate expected output data of integrateHFBData stage
buffer_delay:
  kotekan_stage: bufferDelay
  in_buf: input_buffer
  out_buf: output_buffer
