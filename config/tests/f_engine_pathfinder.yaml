##########################################
#
# F-Engine Data Generator
#
##########################################
---
type: config
log_level: debug

cpu_affinity: [0,1,2,3,4,5,6,7]

buffer_depth: 4
kernel_path: "lib/cuda/kernels"

frame_arrival_period: num_samples_per_frame / adc_frequency

sizeof_uint8: 1
sizeof_uint16: 2
sizeof_uint32: 4
sizeof_uint64: 8
sizeof_int8: 1
sizeof_int16: 2
sizeof_int32: 4
sizeof_int64: 8
sizeof_float16: 2
sizeof_float32: 4
sizeof_float64: 8

# Basic constants
num_components: 2
num_polarizations: 2

# F-Engine simulator: Sky
source_amplitude: 1.0
source_frequency: 0.3e+9        # [Hz]
source_position_ew: 0.02        # east-west
source_position_ns: 0.03        # north-south

# F-Engine simulator: Dishes
num_dish_locations_ew: 12        # east-west
num_dish_locations_ns: 8         # north-south
num_dish_locations: num_dish_locations_ns * num_dish_locations_ew
dish_separation_ew: 6.3          # [m] east-west
dish_separation_ns: 8.5          # [m] north-south
num_dishes: 64

# The actual dishes live on an 11x6 grid.
dish_indices: [
    -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
    -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
    -1,-1,-1, 0, 1, 2, 3, 4, 5, 6, 7, 8,
    -1, 9,10,11,12,13,14,15,16,17,18,19,
    -1,20,21,22,23,24,25,26,27,28,29,30,
    -1,31,32,33,34,35,36,37,38,39,40,41,
    -1,42,43,44,45,46,47,48,49,50,51,52,
    -1,53,54,55,56,57,58,59,60,61,62,63,
]

# F-Engine simulator: ADC
adc_frequency: 3.2e+9           # [Hz]
num_samples_per_frame: 16384

# F-Engine simulator: FT (PFB)
num_taps: 4
num_frequencies: 384       # 8192 frequencies / 16 gpus * 75% coverage
# The frequency channels we keep.
#     A channel's frequency is   freq = channel * adc_frequency / num_samples_per_frame
#     Note that   channel = freq = 0   is the DC channel.
#     Channel 1536 has 300 MHz for CHORD, channel 8192 has 1600 MHz.
# (These particular channels were chosen randomly at or above channel 1536.)
frequency_channels: [
    1542, 1543, 1564, 1584, 1592, 1602, 1658, 1692, 1702, 1710, 1724, 1738, 1746, 1785, 1809, 1890,
    1920, 1922, 1939, 1944, 1949, 1980, 1981, 2019, 2029, 2051, 2055, 2060, 2062, 2066, 2071, 2080,
    2109, 2124, 2131, 2139, 2143, 2144, 2161, 2172, 2174, 2176, 2193, 2199, 2202, 2205, 2206, 2208,
    2213, 2215, 2249, 2254, 2262, 2319, 2325, 2349, 2373, 2383, 2389, 2406, 2428, 2437, 2438, 2439,
    2491, 2497, 2500, 2514, 2545, 2549, 2566, 2583, 2604, 2624, 2626, 2647, 2657, 2669, 2718, 2738,
    2764, 2783, 2849, 2853, 2888, 2892, 2905, 2914, 2933, 2936, 2937, 2980, 3000, 3016, 3027, 3038,
    3099, 3111, 3126, 3131, 3138, 3148, 3153, 3167, 3176, 3208, 3226, 3228, 3232, 3238, 3248, 3265,
    3300, 3304, 3317, 3319, 3352, 3371, 3390, 3396, 3404, 3425, 3447, 3463, 3479, 3486, 3505, 3516,
    3519, 3527, 3541, 3558, 3596, 3621, 3696, 3713, 3724, 3736, 3753, 3760, 3777, 3790, 3829, 3875,
    3878, 3906, 3920, 3924, 3953, 3964, 3967, 3981, 3990, 4031, 4038, 4047, 4054, 4063, 4066, 4078,
    4108, 4113, 4126, 4171, 4232, 4241, 4242, 4252, 4259, 4261, 4299, 4305, 4345, 4373, 4379, 4394,
    4409, 4440, 4446, 4489, 4497, 4534, 4538, 4587, 4592, 4608, 4618, 4629, 4635, 4649, 4656, 4660,
    4673, 4704, 4715, 4718, 4735, 4766, 4770, 4802, 4928, 4946, 4951, 4969, 4970, 4983, 4992, 5002,
    5010, 5011, 5022, 5029, 5038, 5046, 5072, 5112, 5119, 5133, 5160, 5165, 5176, 5187, 5205, 5215,
    5217, 5253, 5263, 5272, 5279, 5288, 5290, 5293, 5307, 5310, 5319, 5337, 5350, 5396, 5449, 5453,
    5499, 5500, 5508, 5515, 5526, 5539, 5540, 5546, 5558, 5616, 5620, 5622, 5624, 5625, 5627, 5649,
    5659, 5721, 5804, 5845, 5932, 5983, 5998, 6015, 6018, 6028, 6035, 6071, 6075, 6078, 6081, 6099,
    6118, 6125, 6140, 6166, 6170, 6187, 6193, 6212, 6222, 6238, 6241, 6261, 6280, 6288, 6290, 6298,
    6315, 6319, 6342, 6343, 6405, 6418, 6442, 6449, 6460, 6484, 6536, 6540, 6573, 6585, 6587, 6595,
    6631, 6708, 6710, 6736, 6743, 6769, 6772, 6779, 6781, 6813, 6818, 6841, 6842, 6847, 6884, 6911,
    6914, 6930, 6935, 6962, 6968, 6982, 6992, 7004, 7014, 7015, 7022, 7024, 7028, 7071, 7076, 7137,
    7139, 7154, 7162, 7227, 7240, 7244, 7246, 7253, 7271, 7307, 7345, 7352, 7355, 7369, 7392, 7404,
    7472, 7576, 7604, 7613, 7616, 7641, 7648, 7660, 7661, 7662, 7668, 7691, 7717, 7719, 7758, 7762,
    7784, 7816, 7817, 7824, 7861, 7890, 7938, 7942, 7943, 7971, 7973, 8047, 8055, 8096, 8120, 8161,
]

# num_times: 2048   # FRB pipeline stalls
# num_times: 4096   # FRB pipeline stalls
num_times: 8192   # works
# num_times: 16384   # buffers too large

# Correlator setup
n2k_sub_integration_ntime: 16384
n2k_samples_per_data_set: 32768

# Baseband beamformer setup
# TODO: use `dish_indices` instead
bb_num_dishes_M: 8
bb_num_dishes_N: 8
# TODO: rename `P`, `Q` to `ew`, `ns`
bb_num_beams_P: 4
bb_num_beams_Q: 4
# TODO: rename `x`, `y` to `ew`, `ns`
bb_beam_separation_x: 0.015        # east-west
bb_beam_separation_y: 0.015        # north-south
bb_num_beams: bb_num_beams_P * bb_num_beams_Q

# Upchannelizer setup
upchannelization_factor: 4
# This mapping was suggested by Seth Siegel's `ice_rfsoc_comparison_dm_2000_tint_1_gamma_0_tsys_30K_tsky.yaml`.
# (This is the "worst case" mapping.)
upchannelization_factor_mapping:
    - 0.0e6: 64
    - 341.65e6: 32
    - 442.01e6: 16
    - 568.66e6: 8
    - 714.99e6: 4
    - 907.41e6: 2
    - 1168.77e6: 1
# # This mapping was suggested by Seth Siegel's `ice_rfsoc_comparison_dm_750_tint_1_gamma_0_tsys_30K_tsky.yaml`.
# # (This is the "default" mapping.)
# upchannelization_factor_mapping:
#     - 0.0e6: 8
#     - 607.9e6: 4
#     - 790.57e6: 2
#     - 1032.16e6: 1

# FRB beamformer setup
frb_downsampling_factor: 256 / upchannelization_factor
# cudaQuantize requires `frb_num_output_times` to be a multiple of 256
frb_num_output_times: 256
# TODO: remove
frb_num_beams_P: 2 * num_dish_locations_ns
frb_num_beams_Q: 2 * num_dish_locations_ew

frb_num_beams_ns: 40
frb_num_beams_ew: 25
frb_num_beams: frb_num_beams_ns * frb_num_beams_ew
# Opening angle is specified in radians (here 2 degrees)
frb_bore_z: 49.3208 * 3.141592653589793 / 180
frb_opening_angle_ns: 2.0 * 3.141592653589793 / 180
frb_opening_angle_ew: 2.0 * 3.141592653589793 / 180

# Pool:
main_pool:
    kotekan_metadata_pool: chordMetadata
    num_metadata_objects: 10 * buffer_depth

# Buffers
host_n2k_correlation_buffer:
    kotekan_buffer: standard
    num_frames: buffer_depth
    frame_size: sizeof_int32 * num_components * num_dishes * num_polarizations * num_dishes * num_polarizations * num_frequencies * (n2k_samples_per_data_set / n2k_sub_integration_ntime)
    metadata_pool: main_pool

host_bb_phase_buffer:
    kotekan_buffer: standard
    num_frames: 1
    frame_size: num_components * num_dishes * bb_num_beams * num_polarizations * num_frequencies
    metadata_pool: main_pool

host_bb_shift_buffer:
    kotekan_buffer: standard
    num_frames: 1
    frame_size: sizeof_int32 * bb_num_beams * num_polarizations * num_frequencies
    metadata_pool: main_pool

host_upchan_gain_buffer:
    kotekan_buffer: standard
    num_frames: 1
    frame_size: sizeof_float16 * num_frequencies * upchannelization_factor
    metadata_pool: main_pool

# host_n2k_correlation_buffer:
#     kotekan_buffer: standard
#     num_frames: buffer_depth
#     frame_size: sizeof_int32 * num_components * num_dishes * num_polarizations * num_dishes * num_polarizations * (num_frequencies * upchannelization_factor) * (n2k_samples_per_data_set / n2k_sub_integration_ntime)
#     metadata_pool: main_pool

host_frb1_phase_buffer:
    kotekan_buffer: standard
    num_frames: 1
    frame_size: sizeof_float16 * num_components * num_dish_locations_ns * num_dish_locations_ew * num_frequencies * upchannelization_factor * num_polarizations
    metadata_pool: main_pool

host_frb2_phase_buffer:
    kotekan_buffer: standard
    num_frames: 1
    frame_size: sizeof_float16 * (2 * num_dish_locations_ns) * (2 * num_dish_locations_ew) * (frb_num_beams_ns * frb_num_beams_ew) * (num_frequencies * upchannelization_factor)
    metadata_pool: main_pool

host_voltage_buffer:
    kotekan_buffer: standard
    num_frames: buffer_depth
    frame_size: num_dishes * num_polarizations * num_frequencies * num_times
    metadata_pool: main_pool
host_voltage_ringbuffer:
    kotekan_buffer: ring
    ring_buffer_size: buffer_depth * num_dishes * num_polarizations * num_frequencies * num_times
    metadata_pool: main_pool

host_expected_bb_beams_buffer:
    kotekan_buffer: standard
    num_frames: buffer_depth
    frame_size: num_times * num_polarizations * num_frequencies * bb_num_beams
    metadata_pool: main_pool

host_expected_frb1_beams_buffer:
    kotekan_buffer: standard
    num_frames: buffer_depth
    frame_size: sizeof_float16 * frb_num_beams_P * frb_num_beams_Q * num_frequencies * upchannelization_factor * frb_num_output_times
    metadata_pool: main_pool

host_bb_beams_buffer:
    kotekan_buffer: standard
    num_frames: buffer_depth
    frame_size: num_times * num_polarizations * num_frequencies * bb_num_beams
    metadata_pool: main_pool

host_upchan_voltage_buffer:
    kotekan_buffer: standard
    num_frames: buffer_depth
    frame_size: num_dishes * num_polarizations * (num_frequencies * upchannelization_factor) * (num_times / upchannelization_factor)
    metadata_pool: main_pool
host_upchan_voltage_ringbuffer:
    kotekan_buffer: ring
    ring_buffer_size: buffer_depth * num_dishes * num_polarizations * (num_frequencies * upchannelization_factor) * (num_times / upchannelization_factor)
    metadata_pool: main_pool

host_frb1_beams_buffer:
    kotekan_buffer: standard
    num_frames: buffer_depth
    frame_size: sizeof_float16 * frb_num_beams_P * frb_num_beams_Q * num_frequencies * upchannelization_factor * frb_num_output_times
    metadata_pool: main_pool
host_frb1_beams_ringbuffer:
    kotekan_buffer: ring
    num_frames: buffer_depth
    ring_buffer_size: buffer_depth * sizeof_float16 * frb_num_beams_P * frb_num_beams_Q * num_frequencies * upchannelization_factor * frb_num_output_times
    metadata_pool: main_pool

host_frb2_beams_buffer:
    kotekan_buffer: standard
    num_frames: buffer_depth
    frame_size: sizeof_float16 * frb_num_beams * num_frequencies * upchannelization_factor * frb_num_output_times
    metadata_pool: main_pool

host_frb3_beams_buffer:
    kotekan_buffer: standard
    num_frames: buffer_depth
    # `1/2` because the output is of type `int4`
    frame_size: frb_num_beams * num_frequencies * upchannelization_factor * frb_num_output_times / 2
    metadata_pool: main_pool

host_frb3_beams_meanstd_buffer:
    kotekan_buffer: standard
    num_frames: buffer_depth
    # `1/256` because the output is quantized in chunks
    frame_size: sizeof_float16 * 2 * frb_num_beams * num_frequencies * upchannelization_factor * frb_num_output_times / 256
    metadata_pool: main_pool

# Stages
run_fengine:
    kotekan_stage: FEngine
    num_frames: 10
    repeat_count: 10
    # skip_julia: true
    E_buffer: host_voltage_buffer
    A_buffer: host_bb_phase_buffer
    s_buffer: host_bb_shift_buffer
    J_buffer: host_expected_bb_beams_buffer
    G_buffer: host_upchan_gain_buffer
    W1_buffer: host_frb1_phase_buffer
    W2_buffer: host_frb2_phase_buffer
    I1_buffer: host_expected_frb1_beams_buffer

run_send_voltage:
    gpu_0:
        kotekan_stage: cudaProcess
        gpu_id: 0
        in_buffers:
            host_voltage_buffer_in: host_voltage_buffer
        out_buffers:
            host_voltage_ringbuffer_out: host_voltage_ringbuffer
        commands:
        - name: cudaCopyToRingbuffer
          input_size: num_dishes * num_polarizations * num_frequencies * num_times
          ring_buffer_size: buffer_depth * input_size
          in_buf: host_voltage_buffer_in
          signal_buf: host_voltage_ringbuffer_out
          gpu_mem_output: voltage_buffer

run_n2k:
    gpu_0:
        kotekan_stage: cudaProcess
        gpu_id: 0
        in_buffers:
            host_voltage_ringbuffer_in: host_voltage_ringbuffer
        out_buffers:
            host_n2k_correlation_buffer_out: host_n2k_correlation_buffer
        commands:
        - name: cudaCorrelator
          num_elements: num_dishes * num_polarizations
          num_local_freq: num_frequencies
          samples_per_data_set: n2k_samples_per_data_set
          sub_integration_ntime: n2k_sub_integration_ntime
          in_signal: host_voltage_ringbuffer_in
          gpu_mem_voltage: voltage_buffer
          gpu_mem_correlation_triangle: n2k_correlation_matrix_buffer
        - name: cudaSyncOutput
        - name: cudaOutputData
          gpu_mem: n2k_correlation_matrix_buffer
          out_buf: host_n2k_correlation_buffer_out

run_bb:
    gpu_0:
        kotekan_stage: cudaProcess
        gpu_id: 0
        in_buffers:
            host_voltage_ringbuffer_in: host_voltage_ringbuffer
            host_bb_phase_in: host_bb_phase_buffer
            host_bb_shift_in: host_bb_shift_buffer
        out_buffers:
            host_bb_beams_out: host_bb_beams_buffer
        commands:
        - name: cudaInputData
          do_once: true
          in_buf: host_bb_phase_in
          gpu_mem: bb_phase_buffer
        - name: cudaInputData
          do_once: true
          in_buf: host_bb_shift_in
          gpu_mem: bb_shift_buffer
        - name: cudaSyncInput
        - name: cudaBasebandBeamformer_pathfinder
          in_signal: host_voltage_ringbuffer_in
          gpu_mem_voltage: voltage_buffer
          gpu_mem_phase: bb_phase_buffer
          gpu_mem_output_scaling: bb_shift_buffer
          gpu_mem_formed_beams: bb_beams_buffer
        - name: cudaSyncOutput
        - name: cudaOutputData
          gpu_mem: bb_beams_buffer
          out_buf: host_bb_beams_out

run_upchan:
    gpu_0:
        kotekan_stage: cudaProcess
        gpu_id: 0
        in_buffers:
            host_voltage_ringbuffer_in: host_voltage_ringbuffer
            host_upchan_gain_buffer_in: host_upchan_gain_buffer
        out_buffers:
            host_upchan_voltage_ringbuffer_out: host_upchan_voltage_ringbuffer
        commands:
        - name: cudaInputData
          do_once: true
          in_buf: host_upchan_gain_buffer_in
          gpu_mem: upchan_gain_buffer
        - name: cudaSyncInput
        - name: cudaUpchannelizer_pathfinder_U4
          in_signal: host_voltage_ringbuffer_in
          out_signal: host_upchan_voltage_ringbuffer_out
          gpu_mem_input_voltage: voltage_buffer
          gpu_mem_gain: upchan_gain_buffer
          gpu_mem_output_voltage: upchan_voltage_buffer

# # n2k: supported (nstations,nfreq):
# #     nstations=128 (pathfinder):
# #         nfreq in (1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048)
# #     nstations=1024 (chord):
# #         nfreq in (1, 2, 4, 8, 16, 32, 64, 128)
# run_n2k:
#     gpu_0:
#         kotekan_stage: cudaProcess
#         gpu_id: 0
#         in_buffers:
#             host_upchan_voltage_ringbuffer_in: host_upchan_voltage_ringbuffer
#         out_buffers:
#             host_n2k_correlation_buffer_in: host_n2k_correlation_buffer
#         commands:
#         - name: cudaCorrelator
#           num_elements: num_dishes * num_polarizations
#           num_local_freq: num_frequencies * upchannelization_factor
#           samples_per_data_set: n2k_samples_per_data_set
#           sub_integration_ntime: n2k_sub_integration_ntime
#           in_signal: host_upchan_voltage_ringbuffer_in
#           gpu_mem_voltage: upchan_voltage_buffer
#           gpu_mem_correlation_triangle: n2k_correlation_matrix_buffer
#         - name: cudaSyncOutput
#         - name: cudaOutputData
#           gpu_mem: n2k_correlation_matrix_buffer
#           out_buf: host_n2k_correlation_buffer_in

run_recv_upchan_voltage:
    gpu_0:
        kotekan_stage: cudaProcess
        gpu_id: 0
        in_buffers:
            host_upchan_voltage_ringbuffer_in: host_upchan_voltage_ringbuffer
        out_buffers:
            host_upchan_voltage_buffer_out: host_upchan_voltage_buffer
        commands:
        - name: cudaCopyFromRingbuffer
          host_signal: host_upchan_voltage_ringbuffer_in
          gpu_mem_input: upchan_voltage_buffer
          output_size: num_dishes * num_polarizations * (num_frequencies * upchannelization_factor) * (num_times / upchannelization_factor)
          ring_buffer_size: buffer_depth * output_size
          out_buf: host_upchan_voltage_buffer_out

run_frb1:
    gpu_0:
        kotekan_stage: cudaProcess
        gpu_id: 0
        in_buffers:
            host_upchan_voltage_ringbuffer_in: host_upchan_voltage_ringbuffer
            host_frb1_phase_buffer_in: host_frb1_phase_buffer
        out_buffers:
            host_frb1_beams_ringbuffer_out: host_frb1_beams_ringbuffer
        commands:
        - name: cudaInputData
          do_once: true
          in_buf: host_frb1_phase_buffer_in
          gpu_mem: frb1_phase_buffer
        - name: cudaSyncInput
        - name: cudaFRBBeamformer_pathfinder_U4
          in_signal: host_upchan_voltage_ringbuffer_in
          out_signal: host_frb1_beams_ringbuffer_out
          gpu_mem_voltage: upchan_voltage_buffer
          gpu_mem_phase: frb1_phase_buffer
          gpu_mem_beamgrid: frb1_beams_buffer

run_recv_frb1_beams:
    gpu_0:
        kotekan_stage: cudaProcess
        gpu_id: 0
        in_buffers:
            host_frb1_beams_ringbuffer_in: host_frb1_beams_ringbuffer
        out_buffers:
            host_frb1_beams_buffer_out: host_frb1_beams_buffer
        commands:
        - name: cudaCopyFromRingbuffer
          host_signal: host_frb1_beams_ringbuffer_in
          gpu_mem_input: frb1_beams_buffer
          output_size: sizeof_float16 * frb_num_beams_P * frb_num_beams_Q * (num_frequencies * upchannelization_factor) * frb_num_output_times
          ring_buffer_size: buffer_depth * output_size
          out_buf: host_frb1_beams_buffer_out

run_frb23:
    gpu_0:
        kotekan_stage: cudaProcess
        gpu_id: 0
        in_buffers:
            host_frb1_beams_ringbuffer_in: host_frb1_beams_ringbuffer
            host_frb2_phase_in: host_frb2_phase_buffer
        out_buffers:
            host_frb2_beams_out: host_frb2_beams_buffer
            host_frb3_beams_out: host_frb3_beams_buffer
            host_frb3_beams_meanstd_out: host_frb3_beams_meanstd_buffer
        commands:
        - name: cudaInputData
          do_once: true
          in_buf: host_frb2_phase_in
          gpu_mem: frb2_phase_buffer
        - name: cudaFRBBeamReformer
          # batched: false
          num_local_freq: num_frequencies * upchannelization_factor
          beam_grid_size_ns: frb_num_beams_P
          beam_grid_size_ew: frb_num_beams_Q
          num_beams: frb_num_beams
          samples_per_data_set: frb_num_output_times
          # cuda_streams: [2, 3]
          in_signal: host_frb1_beams_ringbuffer_in
          gpu_mem_beamgrid: frb1_beams_buffer
          gpu_mem_phase: frb2_phase_buffer
          gpu_mem_beamout: frb2_beams_buffer
        - name: cudaQuantize
          # `1/256` because a chunk has 256 time samples
          num_chunks: frb_num_beams * num_frequencies * upchannelization_factor * frb_num_output_times / 256
          gpu_mem_input: frb2_beams_buffer
          gpu_mem_output: frb3_beams_buffer
          gpu_mem_meanstd: frb3_beams_meanstd_buffer
        - name: cudaSyncOutput
        - name: cudaOutputData
          gpu_mem: frb2_beams_buffer
          out_buf: host_frb2_beams_out
        - name: cudaOutputData
          gpu_mem: frb3_beams_buffer
          out_buf: host_frb3_beams_out
        - name: cudaOutputData
          gpu_mem: frb3_beams_meanstd_buffer
          out_buf: host_frb3_beams_meanstd_out

write_data:
    base_dir: /tmp/f_engine_pathfinder
    write_voltage:
        kotekan_stage: asdfFileWrite
        in_buf: host_voltage_buffer
        file_name: voltage
    write_n2k_correlation:
        kotekan_stage: asdfFileWrite
        in_buf: host_n2k_correlation_buffer
        file_name: n2k_correlation
    write_bb_phase:
        kotekan_stage: asdfFileWrite
        in_buf: host_bb_phase_buffer
        file_name: bb_phase
    write_bb_shift:
        kotekan_stage: asdfFileWrite
        in_buf: host_bb_shift_buffer
        file_name: bb_shift
    # write_expected_bb_beams:
    #     kotekan_stage: asdfFileWrite
    #     in_buf: host_expected_bb_beams_buffer
    #     file_name: expected_bb_beams
    write_bb_beams:
        kotekan_stage: asdfFileWrite
        in_buf: host_bb_beams_buffer
        file_name: bb_beams
    write_upchan_gain:
        kotekan_stage: asdfFileWrite
        in_buf: host_upchan_gain_buffer
        file_name: upchan_gain
    write_upchan_voltage:
        kotekan_stage: asdfFileWrite
        in_buf: host_upchan_voltage_buffer
        file_name: upchan_voltage
    write_frb1_phase:
        kotekan_stage: asdfFileWrite
        in_buf: host_frb1_phase_buffer
        file_name: frb1_phase
    write_frb2_phase:
        kotekan_stage: asdfFileWrite
        in_buf: host_frb2_phase_buffer
        file_name: frb2_phase
    # write_expected_frb1_beams:
    #     kotekan_stage: asdfFileWrite
    #     in_buf: host_expected_frb1_beams_buffer
    #     file_name: expected_frb1_beams
    write_frb1_beams:
        kotekan_stage: asdfFileWrite
        in_buf: host_frb1_beams_buffer
        file_name: frb1_beams
    write_frb2_beams:
        kotekan_stage: asdfFileWrite
        in_buf: host_frb2_beams_buffer
        file_name: frb2_beams
    write_frb3_beams:
        kotekan_stage: asdfFileWrite
        in_buf: host_frb3_beams_buffer
        file_name: frb3_beams
    write_frb3_beams_meanstd:
        kotekan_stage: asdfFileWrite
        in_buf: host_frb3_beams_meanstd_buffer
        file_name: frb3_beams_meanstd
...
